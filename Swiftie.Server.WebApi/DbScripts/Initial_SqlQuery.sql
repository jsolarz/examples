DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Swiftie.Server.WebApi.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201605191453173_Initial'
BEGIN
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserRoles]([UserId])
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE TABLE [dbo].[Stories] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [int] NOT NULL,
        [DateCreated] [datetime] NOT NULL,
        [IsDeleted] [bit] NOT NULL,
        [User_Id] [nvarchar](128),
        [UserProfile_Id] [int],
        CONSTRAINT [PK_dbo.Stories] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_User_Id] ON [dbo].[Stories]([User_Id])
    CREATE INDEX [IX_UserProfile_Id] ON [dbo].[Stories]([UserProfile_Id])
    CREATE TABLE [dbo].[Media] (
        [Id] [int] NOT NULL IDENTITY,
        [Url] [nvarchar](max),
        [Type] [int] NOT NULL,
        [Title] [nvarchar](max),
        [Duration] [float],
        [Width] [int],
        [Height] [int],
        [Aspect] [float],
        [ImageType] [nvarchar](max),
        [Duration1] [float],
        [Width1] [int],
        [Height1] [int],
        [Aspect1] [float],
        [VideoType] [nvarchar](max),
        [Discriminator] [nvarchar](128) NOT NULL,
        [Story_Id] [int],
        CONSTRAINT [PK_dbo.Media] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_Story_Id] ON [dbo].[Media]([Story_Id])
    CREATE TABLE [dbo].[Users] (
        [Id] [nvarchar](128) NOT NULL,
        [UserName] [nvarchar](max) NOT NULL,
        [Password] [nvarchar](100) NOT NULL,
        [ConfirmPassword] [nvarchar](max),
        CONSTRAINT [PK_dbo.Users] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](256),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](256) NOT NULL,
        [Discriminator] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [UserNameIndex] ON [dbo].[AspNetUsers]([UserName])
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](128) NOT NULL,
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserClaims]([UserId])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserLogins]([UserId])
    CREATE TABLE [dbo].[UserProfiles] (
        [Id] [int] NOT NULL IDENTITY,
        [UserProfile_Id] [int],
        [User_Id] [nvarchar](128),
        CONSTRAINT [PK_dbo.UserProfiles] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserProfile_Id] ON [dbo].[UserProfiles]([UserProfile_Id])
    CREATE INDEX [IX_User_Id] ON [dbo].[UserProfiles]([User_Id])
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Stories] ADD CONSTRAINT [FK_dbo.Stories_dbo.Users_User_Id] FOREIGN KEY ([User_Id]) REFERENCES [dbo].[Users] ([Id])
    ALTER TABLE [dbo].[Stories] ADD CONSTRAINT [FK_dbo.Stories_dbo.UserProfiles_UserProfile_Id] FOREIGN KEY ([UserProfile_Id]) REFERENCES [dbo].[UserProfiles] ([Id])
    ALTER TABLE [dbo].[Media] ADD CONSTRAINT [FK_dbo.Media_dbo.Stories_Story_Id] FOREIGN KEY ([Story_Id]) REFERENCES [dbo].[Stories] ([Id])
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[UserProfiles] ADD CONSTRAINT [FK_dbo.UserProfiles_dbo.UserProfiles_UserProfile_Id] FOREIGN KEY ([UserProfile_Id]) REFERENCES [dbo].[UserProfiles] ([Id])
    ALTER TABLE [dbo].[UserProfiles] ADD CONSTRAINT [FK_dbo.UserProfiles_dbo.AspNetUsers_User_Id] FOREIGN KEY ([User_Id]) REFERENCES [dbo].[AspNetUsers] ([Id])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201605191453173_Initial', N'Swiftie.Server.WebApi.Migrations.Configuration',  0x1F8B0800000000000400E51D6B6FDCB8F17B81FE87C57EBA2B7CBB7E34411AD877F0D9F19DD138366E9DBB7E0B6889BB164E8F3D3D121B457F593FF427F52F941429896F9192562BA7081078F9189233C32167389AF9EFBFFF73FAC35314CE3EC3340B92F86C7EB4389CCF60EC257E106FCEE645BEFEEECDFC87EFFFFCA7D3777EF434FBB56A7782DBA19E7176367FCCF3EDDBE532F31E6104B2451478699225EB7CE125D112F8C9F2F8F0F06FCBA3A3254420E608D66C76FA4B11E74104CB1FE8E745127B709B1720BC497C1866B41CD5AC4AA8B30F2082D91678F06CBEFA12ACF3002E563045D35EFC061FCEB7C182F49BCFCEC300A039AD60B89ECF401C2739C8D18CDF7ECCE02A4F9378B3DAA20210DE3F6F216AB7066106E94ADE36CD6D1775788C17B56C3A56A0BC22CB93C811E0D109C5D252ECDE09D7F31A8B088FEF10BEF367BCEA129767F36B1F9645BF2421428038E0DB8B30C58DCFE637F510E7D9F603CC1755C70501799522705F92F4F7050BF16066DDEFA0E6AAE3C521FE7730BB28C2BC48E1590C8B3C05E1C1ECAE780803EFEFF0F93EF91DC66727470FEB9337AF5E03FFE4F55FE1C92B76A568ADA81D57808AEED2640B533437B8AED73F9F2DF97E4BB163DD8DE943B08278096D90F9EC063CBD87F1267F445BE7F8CD7C76153C41BF2AA1CCF5310ED07E429DF2B4403F3F1461081E4258D72F8D63E2FF0DA31EBF7A3DC8A81FC0E76053925E181F6D9C14EDAB5F6058D6668FC1966C2F8EDE9F68B3AB3489F06F9EBF48EDA75552A41E5E4CA26D720FD20DCCF9D99D2E1BE6B562690C6A78B6AEA04E9FB5F14C65F65636C50BEAB213AA21C6DE0DD57C773BAE35C7ADF2247D36B199E9B05A94BD0F66CA360DEB1CD9B24E8C9634BE24BC8EF39363053E196CE075C29F600C539043FF0EE4394CE366BBB6D19CE735DD7866189768E48B14E2F12B40B8E83E88DC79F03ABB84216420FD9820AE04710F217B03FD0028856CC9239F687D235D996249ACB2752A79DA26ED0DF320D5E23470A9661665552FA14E97DE718B95BD07DE62B3F3870CD57A3995255FE3964B43838C457F5AC958F318187C3D0866B19256A4D47147DE077968BA247599B035839E177E907466D0B2F7D00CFA23C8A088D8B9593E16295534A8704C10DCC18EC9EB086C8CB731238ACADEFB47D16F819F3FF63B857E86C1E631EF07035D39A1973BD149214B304AB90D38F2A6F935F061F74D53F6DE3F4774DA345F37639594D92763911B4A47BEC29D5FFA7D7C3C5D0C63ABC53A614B6AC791EF409621FDDAB8E6C3C35D8C7C91C4EB208D2C26B0532E676D12C35B39A66FE178295BE45D0402D34DDAD67A67310AE5CC0E5AA96673FD0CB2C79D2B012BE8152962A8550EA2EDCE47BB7B4C62F8A1881EF0AE196FACC14873FF25B9427A6792BE8B71AFDEF0DE27DEEF4991BF8B7D6C0CF9987BB26DC412C020D339F73C9865578899A17F911471CF0B8DC5F9B473EBF9450882C86C3E2F4D24553BD97ECE546B0DE86C1B578BCFFB6413C41633ACDA696648AACD33A46D5C678821594C9036D3CCAFAC354F8F3419EC05A2A4C7F0877309F66B3FA1C7362A8F772328C9B703054933D2AF202CF6A68BB16C5BEEFDE177430976FABBA19C262AFE8CD4E3D4EA61AE6A8CC05BB557BFF9B5EF396166636F076E99FB506027F49878BEDD22BE2BB7452F2B860067C776325E155D1A5788DB201AAC03F3DB7CAB8D86C278E9A69A1D9C72DA4BD4551286C9179D2B0783D44F4CCBE62EA56C205DA7D4AD5CEF7B78CD81E6C6C78E50B7534F93561B2759B519EC9994052E3E968A75C6997578382D22F1D994DC33AEB3AB106C1A67B73E4FA9B8DDD002E5638C0E80F019095F765BF094B8815891E69F93CABBCDD9FC50221BD7983ECFD1C647E6C6F45982363E96314F70CC169E6759E2052522159E75D42F8A1F12E9DBB376272959C4129FA61B84D4004B78548217244AA9DB98B827CCCE3DE2797801320FF8F2698896E33B4CAC62468DEC574DEE2FD2984874C2147702D860859FD1833897E56C107BC11684AD58127A5ACA68BCF67A0CB1E6126E618C076CC584CDE06AFF2A3C817A1C81286D183A5D321C676644D677444768A523494361EAE0C493F570B190F7911AA48269A8438791539C1759CA5AF3847891DBB244997395E014CB2352BF0D610E0B54D989DAB6ADD268A4BBB38D2A5054A62ACDCCA80165A7224581A811658A021936A36BFD3BC7102A2AA3A015D1450BE174D851B04B6A66462D18BB67471E5163B3238F8C97C58EC4046C4573C11E3C1D66E4ADD0FBBB6CC9581A9B13394C4C9E11D52AB48EE42DFA347F9DA84D264ED730B3326E3744F76B994A51B799A9A4B50F8D0A51E577BC09764481F17EAA370C74219219748B60E97173256609B48D72B4896A8DBAC4E9E5032E864FB9C2F88046A5F6874CE94F4DC0AE60CEBF06364610A5922C21840722CA5213C046DEB600ADED511228CA582DFDA96224F5A6E52DBD4BD5F448D15D36CCEA7AB720C109ABD583B61122BDE13B80AD5EA18D60E94DCD66C9746FA820723B4E80C56C01799EECF7704C43FD5773E27165651FAA97536F09E9D8B332E7307014BB42BCC5F00BB7400AF7FD8A8C0DAD89A2D548C1CCBBDE78060CA88C120C08F51EEBBA5CB25B74AB95CF82366B45A7B572E29E8150098ADE6B553AB0E8195E6BBFB0B660888BB0627995C141C3F3D51A86C54C25B25A30A352A5AD95E9EE9811745F0D66AA350C8B192A635A10A350EA6CD5BAEE68E1B5B01DCB48CDEB9B8C170B1DC341CB10B1D39C85062C99B50A5B903D91540B41338A947A87B5E6D11B3DA2A6D12EC57BA24577EC9815113B55A437368CC7910322AAF7CF5AD1A8EB4E972458082D385D6AA28A9CDE80ED3688374C94115A325B91102317DFADDC236E4404C6D2E3184E548BEA911007800D146AF107063EBC0AD22CBF04397800F8BDF6C28FA466825AA5B9E95683B19A934CADEADE5BB5C67FD3DB8CF1B33C56E192CD3314DA155A65840D3CA527834290AABBCF70E417108254E13C7191844514EBED4DFADEC41B98ED4F4A6408A74B61FE924949C29B64EFE389604522F974199C5CB53ADB9D647A103AC457963916F53A6B9D1E4AF598CA42D13DB0EE8D84FA43A723E188F1C09D5A9A7EBBD959C310988BD2C082E22AECE131911AB8A535C593611B9D0AAC679AEB0CFF7DBBFEA6DD6BE7DB0EECA39CD0CED807C71BE0780717D8F7278E4E2C0052E200818410E04090A2E159A48F3420EE4C132767F36134B789EB5225247497F183D27C4EDDAFA8E7160722C8BC34888218A0E54D8D34C42D6DE2A4A11F9BB30068913D8CEA6B73164855660FA5FADE9C8552953988F82692018794A6D88ED9A84FE18B6136E2A938716633CB01C9066902A5E35B27207AC67502A3E75C27304CAC041612536CC7BAD4697554D6ED78CBA1B6E7C17681CA9A61B109D4DD76773396F5CEA6D41E5213748085D494DA4392A218B000A5CA6971CF0EEEC8AC5EDBE5AACC3D928EC45634B2000B801639C2603E4E97803175EE6C4AE207A85895D4D843148204B020852A8759B2A100B849B2159DE06930AA6EE1A0A1481FFF73CA8A546B0F5911068005ADA8EE005B3167B1CEE1049623057087B15CBD4B81BD577D50F8687072D24B56EBC4CF1C5FCC9DDB8CA9C9219AF7DD7909D743C563FC4E8847FC8EFA51500363CAE65526F60077E16B8A1D61D1E80212305A3E49BED2FA590CC057C4F1AC1F5F6960E8CF57EEFB7DFE7835061DD0C3E43ECAE7AE30A6A0047A786EDCBB4FE5A27ED51E5443ADBC08BB29AADADEFD44CDAED1CC3FE0CB6F64B553A0CB3358D5C7CAAA851D11149F960B8E843262AC904A20A9BF3660C6759B92F65B87CE74364EA6B9315C67380841FD85B8CD4245178D8E4C402E274E3C40BA583D776AF1CD7AA374447709623006609D6D26457FCD327B935FE3F4E62E56D9DE0EF2534109A3BB5C0F2EA9600EC02C46F7BBC9F18D7EE183B24FED4DD78179EABE5DE589C185707A2C23B824FEBF328CD3A123771C4ECA4CE818D2797E4E8E473A3187E4352A36A9AFC3B4A4FE5D7B8D528FCDF60475920B2769329F55EA1362B8E72C87D1023758ACFE082FC200622365D5E006C4C11A66398992333F3E3C3A1632DB4D27CBDC32CB7C2E76564BAA399E702344D98A3F83D47B04A91CD9AD4726B606A8F441E375ECC3A7B3F93FCB5E6F4B4F68FC57597C8098FB631CFC51A08AFBB480B37FC9E168074AB961F4D59C681E317BAC5EFFE313E97A30BB4DD18E793B3B1470D985C27C7631A7D990AE3D66E398736CF46D146001D51A8EAE5704C67288FE89BD7CF4231F24B1D743E03EA1FA88EAC8D29FECB9C8260AAC78AB62306D39A1A6373F2FD33C1CB37B7D25CCDC24CDAAA8FE4D049EBE7525191B1DB8CB96B867B361F59A8998E0661D26207705C2A5B711D663D39FCF6DD301009FD8A6D31AA47C4983A0F5A83F5E8F7A23B60F84DAE9ADC732A48C41FD50CBBF6C0E7C036C6CA16E62B4EAB703012A3F26BFA83B75E356D142FC4E7981D4D3C499818649FBE3C0AADD52FBBC5CC272996F94500565A77BA29B2EB73455929B5E824799C8A6174445B29AA1E00D82425D329A2EB0B489685477799BC5AA13D374999A36294D97AB994EDCB59F2255CF61CC08BB3D387BA44BF94A3481495935A49423BDC4889C5664D7A7A0C223E6ABCCBA31D8D97B2727D518F4C2B62FD676BA142B1F645EB44419DF8C3331EB968EFE8385E09F4AD4FDDA68BFE760FB63877CB51EF36584D5EF1D499FF19073089EDF95F2BA401383935CF30DAA62209397DD68945668E27C88A30EF1FFBB30CB4064D67CBD303895EDD9C9E0C23076047187FC0A538A1A4E03A96A2634562285B18F0BDD671C0E2FD953CE98302506A3217535131A2B35C2D80CA6FB9E63CA0C669F03614AFCB5EFDBEE3EB8CBFAB6BB57E6527B5A9BAE4395E63D78EC7EE2FA660775C0CB92C6B57317EC212ED6963BCCEEC223738943BA87817864FC0BF4883CE1768F9E14271835A74E4791BDB01859508C7D90B832E1983A96E06A5DBFA18B916D452A52877A95D7705BBE0FE2627D36F71F124478624024A9C0D541BA758335D70DED804D13FDA0559BF681A9A09246A3E5AA2174C1A345D02DF94454A0ED538D68138DA8C0120BAC0B0D5A53919871EF3618D58F8D23D236E6613509044C6353D5C938366D631E5B13A25F45BB5A122A4958D7EA2879A70BEABE8FAC28CAE0FCAA743D2DAA87024A5369FEDAC40209C3654191C2C8AB1E2A250B32D36742994ED88DDEC465332DC71205534C66A265316B46E5C494261EC9C088D845EE92FE88E064A62680C6C088183E55497F348C21B8D4DAFFB0A949241150971B10219905EC604C30F148A7E5EF4E104AFA5BBF8422FD59BE03AA86491F227FF08974A222C6EE88E4D725CC824D03027FC21A438FD386EA36D7F13AA9B43261465513C1D5E206E6C047AAD2799A076BE0E5A81A7B2206F1665E45F87A173D40FF3ABE2DF26D91A325C3E821E478002B77A6F1CB1C29FC9C4F6FB7F85736C412D03403ECC1791BFF5804A15FCFFB4AE1DBA30181B546EA47836999637F9ACD730DE943125B02A2E8AB95DD7B186D43042CBB8D57E033EC3237C481EFE10678CF8D27970E483B2178B49F5E0660938228A3309AFEE827E2613F7AFAFE7F434689EDBEAB0000 , N'6.1.3-40302')
END

